# Proposal: 用百分比替换固定强度配置

## 问题陈述

当前系统使用固定的"每段N个词"强度配置（低4/中8/高14），在文本较多的网站上会出现以下问题：

1. **翻译密度不合理**：发送上千字符文本但只翻译少量词汇（如1000字符只翻译8个词）
2. **用户体验不一致**：短段落和长段落的翻译密度差异巨大
3. **配置不直观**：用户难以理解"每段8个词"在实际使用中的效果

## 解决方案

### 核心改进

1. **移除固定强度配置**
   - 删除 `INTENSITY_CONFIG` 中的 `low/medium/high` 配置
   - 移除 `maxPerParagraph` 概念
   - 直接废弃旧配置，不做兼容

2. **引入百分比配置**
   - 预设 4 个百分比档位：10%、30%、50%、70%
   - 支持用户自定义百分比值（1-100%）
   - 默认值：30%
   - 只传递百分比给 AI，让 AI 自行决定翻译哪些词汇

3. **智能文本分块**
   - 目标：每批次约 1000 字符
   - 上限：不超过 1200 字符
   - 按 DOM 段落拼接，避免语义割裂
   - 示例：
     - 段落1(300字) + 段落2(400字) + 段落3(200字) = 900字 → 发送
     - 段落4(800字) → 单独发送
     - 段落5(400字) + 段落6(300字) = 700字 → 发送

### AI 提示词策略

**只传递百分比，不计算具体词数：**
- 中文：2-4 字符 = 1 个词汇
- 英文：4-10 字符 = 1 个词汇
- 客户端无法准确计算，交给 AI 根据语言特性自行决策

**提示词示例：**
```
翻译密度：30%
请根据此密度选择适合学习的词汇进行翻译。
```

## 范围限制

**本次实现：**
- ✅ 仅翻译单词（保持现有行为）
- ✅ 百分比应用于词汇翻译
- ✅ 智能文本分块机制
- ✅ 用户自定义百分比值

**未来扩展（本次不实现）：**
- ❌ 翻译完整句子
- ❌ 显示翻译进度

## 用户体验

- 后台静默处理，无需显示进度
- 保持现有的可视区域优先加载机制
- 配置界面：预设档位 + 自定义输入

## 技术影响

**修改的文件：**
- `js/content/constants.js` - 更新配置常量
- `js/content/api-client.js` - 修改翻译逻辑
- `js/content/main.js` - 修改文本分块逻辑
- `js/content/prompt-rules.js` - 更新 AI 提示词
- `js/options.js` - 更新配置界面
- `options.html` - 更新 UI

**不做向后兼容：**
- 直接废弃旧的 `intensity` 配置
- 新配置 `translationDensity` 默认 30%

## 成功标准

1. AI 根据百分比合理选择词汇（主观评估）
2. 文本分块不超过 1200 字符
3. 段落语义保持完整（不在段落中间切分）
4. 翻译质量不下降
