# Proposal: translation-api-config

## Summary

æ–°å¢ç¿»è¯‘ API é…ç½®åŠŸèƒ½ï¼Œæ”¯æŒé…ç½®å¤šä¸ªç¿»è¯‘æœåŠ¡ï¼ˆæœ‰é“ç¿»è¯‘ã€ç™¾åº¦ç¿»è¯‘ã€è°·æ­Œç¿»è¯‘ç­‰ï¼‰ï¼Œé‡‡ç”¨ä¸ AI èŠ‚ç‚¹ç±»ä¼¼çš„é…ç½®æ–¹å¼ï¼Œæ”¯æŒå¤šèŠ‚ç‚¹ã€ä¼˜å…ˆçº§æ’åºã€è¿é€šæ€§æµ‹è¯•å’Œè‡ªåŠ¨æ•…éšœè½¬ç§»ã€‚

## Motivation

å½“å‰ç¿»è¯‘åŠŸèƒ½å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

1. **ç¡¬ç¼–ç ä¾èµ–**ï¼šè¯æ±‡æŸ¥è¯¢ä¾èµ– `dict.youdao.com`ï¼Œè¯­å¥ç¿»è¯‘ä¾èµ– `fanyi.youdao.com`ï¼Œæ— æ³•è‡ªå®šä¹‰
2. **å•ç‚¹æ•…éšœ**ï¼šæœ‰é“ API ä¸å¯ç”¨æ—¶æ— æ³•è‡ªåŠ¨åˆ‡æ¢åˆ°å…¶ä»–æœåŠ¡
3. **çµæ´»æ€§ä¸è¶³**ï¼šç”¨æˆ·æ— æ³•æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©ç¿»è¯‘æœåŠ¡ï¼ˆå¦‚éœ€è¦è°·æ­Œç¿»è¯‘çš„è´¨é‡æˆ–ç™¾åº¦ç¿»è¯‘çš„ä¸­æ–‡ä¼˜åŒ–ï¼‰
4. **æˆæœ¬æ§åˆ¶**ï¼šæ— æ³•åˆ©ç”¨ç”¨æˆ·å·²æœ‰çš„ç¿»è¯‘ API é…é¢

é€šè¿‡å¼•å…¥å¯é…ç½®çš„ç¿»è¯‘ API èŠ‚ç‚¹ï¼Œç”¨æˆ·å¯ä»¥ï¼š
- ä½¿ç”¨è‡ªå·±çš„ API å¯†é’¥ï¼Œé¿å…å…±äº«é…é¢é™åˆ¶
- é…ç½®å¤šä¸ªç¿»è¯‘æœåŠ¡ä½œä¸ºå¤‡é€‰
- æ ¹æ®ç¿»è¯‘è´¨é‡å’Œé€Ÿåº¦é€‰æ‹©æœ€é€‚åˆçš„æœåŠ¡

## Scope

### In Scope

- ç¿»è¯‘ API èŠ‚ç‚¹é…ç½® UIï¼ˆå‚è€ƒç°æœ‰ AI èŠ‚ç‚¹é…ç½®ï¼‰
- æ”¯æŒçš„ç¿»è¯‘æœåŠ¡ï¼šæœ‰é“ç¿»è¯‘ã€ç™¾åº¦ç¿»è¯‘ã€è°·æ­Œç¿»è¯‘ã€DeepL
- èŠ‚ç‚¹ç®¡ç†ï¼šæ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤ã€æ’åºï¼ˆä¼˜å…ˆçº§ï¼‰
- è¿é€šæ€§æµ‹è¯•åŠŸèƒ½
- é€Ÿç‡é™åˆ¶é…ç½®ï¼ˆå¯é€‰ï¼‰
- è‡ªåŠ¨æ•…éšœè½¬ç§»æœºåˆ¶
- é™çº§ç­–ç•¥ï¼šæ— é…ç½®æ—¶ä½¿ç”¨ç°æœ‰å…è´¹ API

### Out of Scope

- è‡ªå®šä¹‰ç¿»è¯‘ API ç«¯ç‚¹ï¼ˆéæ ‡å‡† APIï¼‰
- ç¿»è¯‘ç»“æœç¼“å­˜ç­–ç•¥è°ƒæ•´ï¼ˆä½¿ç”¨ç°æœ‰ç¼“å­˜ï¼‰
- ç¿»è¯‘è´¨é‡è¯„ä¼°å’Œè‡ªåŠ¨é€‰æ‹©
- ä»˜è´¹æœåŠ¡çš„è®¡è´¹ç®¡ç†

## Solution Overview

### é…ç½® UI è®¾è®¡

åœ¨è®¾ç½®é¡µé¢ã€ŒAPI é…ç½®ã€section ä¸‹æ–°å¢ã€Œç¿»è¯‘ APIã€å­åŒºåŸŸï¼Œä¸ç°æœ‰ AI èŠ‚ç‚¹é…ç½®å¹¶åˆ—ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API é…ç½®                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â–¼ AI èŠ‚ç‚¹                                               â”‚
â”‚   [ç°æœ‰ AI èŠ‚ç‚¹é…ç½®...]                                  â”‚
â”‚                                                         â”‚
â”‚ â–¼ ç¿»è¯‘ API                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ ç¿»è¯‘ API èŠ‚ç‚¹                                    â”‚   â”‚
â”‚   â”‚ æ‹–æ‹½è°ƒæ•´ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆä½¿ç”¨æ’åœ¨å‰é¢çš„èŠ‚ç‚¹            â”‚   â”‚
â”‚   â”‚                                    [+ æ·»åŠ èŠ‚ç‚¹]  â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚   â”‚ â”‚ â‰¡ ç™¾åº¦ç¿»è¯‘                        âœ“ å·²è¿æ¥  â”‚ â”‚   â”‚
â”‚   â”‚ â”‚   appid: 2024***                           â”‚ â”‚   â”‚
â”‚   â”‚ â”‚   [ç¼–è¾‘] [æµ‹è¯•] [åˆ é™¤]                      â”‚ â”‚   â”‚
â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚   â”‚ â”‚ â‰¡ æœ‰é“ç¿»è¯‘                        â—‹ æœªæµ‹è¯•  â”‚ â”‚   â”‚
â”‚   â”‚ â”‚   appKey: abc***                           â”‚ â”‚   â”‚
â”‚   â”‚ â”‚   [ç¼–è¾‘] [æµ‹è¯•] [åˆ é™¤]                      â”‚ â”‚   â”‚
â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â”‚   â“˜ æœªé…ç½®ç¿»è¯‘ API æ—¶ï¼Œå°†ä½¿ç”¨å†…ç½®å…è´¹æœåŠ¡ï¼ˆæœ‰é™åˆ¶ï¼‰      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### èŠ‚ç‚¹ç¼–è¾‘å¼¹çª—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ·»åŠ ç¿»è¯‘èŠ‚ç‚¹                                      [Ã—]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ èŠ‚ç‚¹åç§°                                                â”‚
â”‚ [ç™¾åº¦ç¿»è¯‘                                          ]    â”‚
â”‚                                                         â”‚
â”‚ ç¿»è¯‘æœåŠ¡                                                â”‚
â”‚ [â–¼ ç™¾åº¦ç¿»è¯‘                                       ]    â”‚
â”‚                                                         â”‚
â”‚ APP ID / App Key                                        â”‚
â”‚ [20241234567890                                    ]    â”‚
â”‚                                                         â”‚
â”‚ å¯†é’¥ / Secret Key                                       â”‚
â”‚ [********************************              ğŸ‘ ]    â”‚
â”‚                                                         â”‚
â”‚ é€Ÿç‡é™åˆ¶ (QPS)                                          â”‚
â”‚ [10        ] æ¬¡/ç§’    â“˜ 0 æˆ–ç•™ç©ºè¡¨ç¤ºæ— é™åˆ¶              â”‚
â”‚                                                         â”‚
â”‚ å¿«é€Ÿå¡«å……                                                â”‚
â”‚ [ç™¾åº¦ç¿»è¯‘] [æœ‰é“ç¿»è¯‘] [è°·æ­Œç¿»è¯‘] [DeepL]                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [âœ“ æµ‹è¯•è¿æ¥]  è¿æ¥æˆåŠŸ âœ“                                â”‚
â”‚                                    [å–æ¶ˆ]  [ä¿å­˜]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ”¯æŒçš„ç¿»è¯‘æœåŠ¡

| æœåŠ¡ | API ç±»å‹ | è®¤è¯æ–¹å¼ | ç‰¹ç‚¹ |
|------|----------|----------|------|
| ç™¾åº¦ç¿»è¯‘ | REST | appid + secretKey + sign | ä¸­æ–‡ä¼˜åŒ–ï¼Œå…è´¹é¢åº¦å¤§ |
| æœ‰é“ç¿»è¯‘ | REST | appKey + appSecret + sign | è¯å…¸åŠŸèƒ½å¼ºï¼ŒéŸ³æ ‡æ”¯æŒ |
| è°·æ­Œç¿»è¯‘ | REST | API Key | å¤šè¯­è¨€è´¨é‡é«˜ |
| DeepL | REST | API Key | ç¿»è¯‘è´¨é‡æœ€ä½³ |

### æ•°æ®ç»“æ„

```javascript
// å­˜å‚¨ç»“æ„
{
  translationNodes: [
    {
      id: "uuid-1",
      name: "ç™¾åº¦ç¿»è¯‘",
      provider: "baidu",        // baidu | youdao | google | deepl
      appId: "20241234567890",  // ç™¾åº¦/æœ‰é“
      secretKey: "encrypted",   // åŠ å¯†å­˜å‚¨
      apiKey: "",               // è°·æ­Œ/DeepL
      rateLimit: 10,            // QPSï¼Œ0 è¡¨ç¤ºæ— é™åˆ¶
      enabled: true,
      lastTestTime: 1704067200000,
      lastTestResult: "success" // success | failed | untested
    }
  ],
  translationFallbackEnabled: true  // æ— èŠ‚ç‚¹æ—¶æ˜¯å¦ä½¿ç”¨å†…ç½®æœåŠ¡
}
```

### ç¿»è¯‘ç­–ç•¥

```
ç”¨æˆ·é€‰ä¸­æ–‡æœ¬
    â†“
æ£€æŸ¥æ˜¯å¦æœ‰é…ç½®çš„ç¿»è¯‘èŠ‚ç‚¹
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æœ‰é…ç½®èŠ‚ç‚¹                               â”‚
â”‚   â†“                                     â”‚
â”‚ æŒ‰ä¼˜å…ˆçº§ä¾æ¬¡å°è¯•                         â”‚
â”‚   â†“                                     â”‚
â”‚ èŠ‚ç‚¹å¯ç”¨ï¼Ÿ â”€â”€å¦â”€â”€â†’ å°è¯•ä¸‹ä¸€èŠ‚ç‚¹          â”‚
â”‚   â†“æ˜¯                                   â”‚
â”‚ è°ƒç”¨ç¿»è¯‘ API                            â”‚
â”‚   â†“                                     â”‚
â”‚ æˆåŠŸï¼Ÿ â”€â”€å¦â”€â”€â†’ æ ‡è®°èŠ‚ç‚¹å¤±è´¥ï¼Œå°è¯•ä¸‹ä¸€èŠ‚ç‚¹ â”‚
â”‚   â†“æ˜¯                                   â”‚
â”‚ è¿”å›ç»“æœ                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ æ‰€æœ‰èŠ‚ç‚¹å¤±è´¥æˆ–æ— é…ç½®
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é™çº§å¤„ç†                                 â”‚
â”‚   â†“                                     â”‚
â”‚ fallbackEnabledï¼Ÿ                       â”‚
â”‚   â†“æ˜¯                                   â”‚
â”‚ ä½¿ç”¨å†…ç½®å…è´¹æœåŠ¡ï¼ˆç°æœ‰é€»è¾‘ï¼‰              â”‚
â”‚   â†“å¦                                   â”‚
â”‚ è¿”å›é”™è¯¯æç¤º                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç»Ÿä¸€é€‚é…å±‚æ¶æ„

ç”±äºå„ç¿»è¯‘ API æä¾›å•†çš„å‚æ•°æ ¼å¼å’Œè¿”å›å€¼ç»“æ„å„ä¸ç›¸åŒï¼Œéœ€è¦è®¾è®¡ç»Ÿä¸€çš„é€‚é…å±‚æ¥å±è”½å·®å¼‚ã€‚

#### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä¸Šå±‚è°ƒç”¨æ–¹                                â”‚
â”‚              (api-client.js / event-handlers.js)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TranslationService                           â”‚
â”‚                      (ç»Ÿä¸€å…¥å£)                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ translate(request: TranslationRequest): TranslationResult â”‚  â”‚
â”‚  â”‚ lookup(word: string): DictionaryResult                    â”‚  â”‚
â”‚  â”‚ testConnection(nodeId): boolean                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ProviderAdapter                              â”‚
â”‚                   (é€‚é…å™¨åŸºç±»/æ¥å£)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ + buildRequest(req: TranslationRequest): ProviderRequest  â”‚  â”‚
â”‚  â”‚ + parseResponse(resp: any): TranslationResult             â”‚  â”‚
â”‚  â”‚ + mapLanguageCode(code: string): string                   â”‚  â”‚
â”‚  â”‚ + getCapabilities(): ProviderCapabilities                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BaiduAdapter  â”‚   â”‚ YoudaoAdapter â”‚   â”‚ GoogleAdapter â”‚  ...
â”‚               â”‚   â”‚               â”‚   â”‚               â”‚
â”‚ - ç­¾åç®—æ³•    â”‚   â”‚ - ç­¾åç®—æ³•    â”‚   â”‚ - API Key    â”‚
â”‚ - è¯­è¨€æ˜ å°„    â”‚   â”‚ - è¯å…¸è§£æ    â”‚   â”‚ - è¯­è¨€æ˜ å°„    â”‚
â”‚ - ç»“æœè½¬æ¢    â”‚   â”‚ - éŸ³æ ‡æå–    â”‚   â”‚ - ç»“æœè½¬æ¢    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ç»Ÿä¸€æ•°æ®ç»“æ„

```typescript
// ==================== è¾“å…¥ç»“æ„ ====================

/** ç¿»è¯‘è¯·æ±‚ï¼ˆç»Ÿä¸€æ ¼å¼ï¼‰ */
interface TranslationRequest {
  text: string;              // å¾…ç¿»è¯‘æ–‡æœ¬
  from: LanguageCode;        // æºè¯­è¨€ï¼ˆç»Ÿä¸€ç¼–ç ï¼‰
  to: LanguageCode;          // ç›®æ ‡è¯­è¨€ï¼ˆç»Ÿä¸€ç¼–ç ï¼‰
  type: 'word' | 'sentence'; // ç¿»è¯‘ç±»å‹
  options?: {
    needPhonetic?: boolean;  // æ˜¯å¦éœ€è¦éŸ³æ ‡
    needDict?: boolean;      // æ˜¯å¦éœ€è¦è¯å…¸é‡Šä¹‰
    needExample?: boolean;   // æ˜¯å¦éœ€è¦ä¾‹å¥
  };
}

/** ç»Ÿä¸€è¯­è¨€ç¼–ç ï¼ˆISO 639-1 ä¸ºåŸºç¡€ï¼‰ */
type LanguageCode =
  | 'zh-CN'  // ç®€ä½“ä¸­æ–‡
  | 'zh-TW'  // ç¹ä½“ä¸­æ–‡
  | 'en'     // è‹±è¯­
  | 'ja'     // æ—¥è¯­
  | 'ko'     // éŸ©è¯­
  | 'fr'     // æ³•è¯­
  | 'de'     // å¾·è¯­
  | 'es'     // è¥¿ç­ç‰™è¯­
  | 'auto';  // è‡ªåŠ¨æ£€æµ‹

// ==================== è¾“å‡ºç»“æ„ ====================

/** ç¿»è¯‘ç»“æœï¼ˆç»Ÿä¸€æ ¼å¼ï¼‰ */
interface TranslationResult {
  success: boolean;
  provider: string;          // å®é™…ä½¿ç”¨çš„æä¾›å•†

  // åŸºç¡€ç¿»è¯‘
  translation: string;       // ç¿»è¯‘ç»“æœ
  detectedLang?: LanguageCode; // æ£€æµ‹åˆ°çš„æºè¯­è¨€

  // è¯å…¸ä¿¡æ¯ï¼ˆå•è¯ç¿»è¯‘æ—¶ï¼‰
  dictionary?: DictionaryInfo;

  // é”™è¯¯ä¿¡æ¯
  error?: {
    code: string;
    message: string;
  };
}

/** è¯å…¸ä¿¡æ¯ï¼ˆç»Ÿä¸€æ ¼å¼ï¼‰ */
interface DictionaryInfo {
  phonetic?: {
    us?: string;             // ç¾å¼éŸ³æ ‡
    uk?: string;             // è‹±å¼éŸ³æ ‡
  };
  definitions?: Array<{
    pos: string;             // è¯æ€§ (n. / v. / adj. ...)
    meanings: string[];      // é‡Šä¹‰åˆ—è¡¨
    examples?: string[];     // ä¾‹å¥
  }>;
  forms?: {                  // è¯å½¢å˜åŒ–
    plural?: string;
    past?: string;
    pastParticiple?: string;
    presentParticiple?: string;
  };
}

// ==================== æä¾›å•†èƒ½åŠ›å£°æ˜ ====================

/** æä¾›å•†èƒ½åŠ› */
interface ProviderCapabilities {
  supportedLanguages: LanguageCode[];  // æ”¯æŒçš„è¯­è¨€
  supportDict: boolean;                // æ˜¯å¦æ”¯æŒè¯å…¸
  supportPhonetic: boolean;            // æ˜¯å¦æ”¯æŒéŸ³æ ‡
  supportDetect: boolean;              // æ˜¯å¦æ”¯æŒè¯­è¨€æ£€æµ‹
  maxTextLength: number;               // æœ€å¤§æ–‡æœ¬é•¿åº¦
  qpsLimit: number;                    // é»˜è®¤ QPS é™åˆ¶
}
```

#### è¯­è¨€ä»£ç æ˜ å°„

å„æä¾›å•†ä½¿ç”¨ä¸åŒçš„è¯­è¨€ä»£ç ï¼Œé€‚é…å™¨è´Ÿè´£è½¬æ¢ï¼š

| ç»Ÿä¸€ç¼–ç  | ç™¾åº¦ | æœ‰é“ | è°·æ­Œ | DeepL |
|----------|------|------|------|-------|
| `zh-CN`  | `zh` | `zh-CHS` | `zh-CN` | `ZH` |
| `zh-TW`  | `cht` | `zh-CHT` | `zh-TW` | `ZH` |
| `en`     | `en` | `en` | `en` | `EN` |
| `ja`     | `jp` | `ja` | `ja` | `JA` |
| `ko`     | `kor` | `ko` | `ko` | `KO` |
| `fr`     | `fra` | `fr` | `fr` | `FR` |
| `de`     | `de` | `de` | `de` | `DE` |
| `auto`   | `auto` | `auto` | `auto` | âŒ |

#### é€‚é…å™¨å®ç°ç¤ºä¾‹

```javascript
// translation-adapters.js

/**
 * é€‚é…å™¨åŸºç±»
 */
class BaseAdapter {
  constructor(config) {
    this.config = config;
  }

  // å­ç±»å¿…é¡»å®ç°
  async doTranslate(text, from, to) {
    throw new Error('Not implemented');
  }

  // å­ç±»å¿…é¡»å®ç°
  mapLanguageCode(code) {
    throw new Error('Not implemented');
  }

  // å­ç±»å¯é€‰å®ç°
  parseDict(response) {
    return null;
  }

  // ç»Ÿä¸€å…¥å£
  async translate(request) {
    try {
      const from = this.mapLanguageCode(request.from);
      const to = this.mapLanguageCode(request.to);

      const rawResponse = await this.doTranslate(request.text, from, to);

      return {
        success: true,
        provider: this.name,
        translation: this.extractTranslation(rawResponse),
        dictionary: request.options?.needDict
          ? this.parseDict(rawResponse)
          : undefined
      };
    } catch (error) {
      return {
        success: false,
        provider: this.name,
        translation: '',
        error: {
          code: error.code || 'UNKNOWN',
          message: error.message
        }
      };
    }
  }
}

/**
 * ç™¾åº¦ç¿»è¯‘é€‚é…å™¨
 */
class BaiduAdapter extends BaseAdapter {
  name = 'baidu';

  languageMap = {
    'zh-CN': 'zh', 'zh-TW': 'cht', 'en': 'en',
    'ja': 'jp', 'ko': 'kor', 'fr': 'fra',
    'de': 'de', 'es': 'spa', 'auto': 'auto'
  };

  mapLanguageCode(code) {
    return this.languageMap[code] || code;
  }

  async doTranslate(text, from, to) {
    const { appId, secretKey } = this.config;
    const salt = Date.now();
    const sign = md5(appId + text + salt + secretKey);

    const response = await fetch(
      `https://fanyi-api.baidu.com/api/trans/vip/translate?` +
      new URLSearchParams({ q: text, from, to, appid: appId, salt, sign })
    );

    const data = await response.json();
    if (data.error_code) {
      throw { code: data.error_code, message: data.error_msg };
    }
    return data;
  }

  extractTranslation(response) {
    return response.trans_result?.[0]?.dst || '';
  }

  getCapabilities() {
    return {
      supportedLanguages: ['zh-CN', 'zh-TW', 'en', 'ja', 'ko', 'fr', 'de', 'es'],
      supportDict: false,
      supportPhonetic: false,
      supportDetect: true,
      maxTextLength: 6000,
      qpsLimit: 10
    };
  }
}

/**
 * æœ‰é“ç¿»è¯‘é€‚é…å™¨ï¼ˆæ”¯æŒè¯å…¸ï¼‰
 */
class YoudaoAdapter extends BaseAdapter {
  name = 'youdao';

  languageMap = {
    'zh-CN': 'zh-CHS', 'zh-TW': 'zh-CHT', 'en': 'en',
    'ja': 'ja', 'ko': 'ko', 'fr': 'fr',
    'de': 'de', 'es': 'es', 'auto': 'auto'
  };

  mapLanguageCode(code) {
    return this.languageMap[code] || code;
  }

  async doTranslate(text, from, to) {
    const { appKey, appSecret } = this.config;
    const salt = Date.now().toString();
    const curtime = Math.floor(Date.now() / 1000).toString();
    const input = text.length > 20
      ? text.slice(0, 10) + text.length + text.slice(-10)
      : text;
    const sign = sha256(appKey + input + salt + curtime + appSecret);

    const response = await fetch('https://openapi.youdao.com/api', {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: new URLSearchParams({
        q: text, from, to, appKey, salt, sign, signType: 'v3', curtime
      })
    });

    const data = await response.json();
    if (data.errorCode !== '0') {
      throw { code: data.errorCode, message: this.getErrorMessage(data.errorCode) };
    }
    return data;
  }

  extractTranslation(response) {
    return response.translation?.[0] || '';
  }

  // æœ‰é“ç‰¹æœ‰ï¼šè§£æè¯å…¸ä¿¡æ¯
  parseDict(response) {
    if (!response.basic) return null;

    const basic = response.basic;
    return {
      phonetic: {
        us: basic['us-phonetic'],
        uk: basic['uk-phonetic']
      },
      definitions: this.parseExplains(basic.explains)
    };
  }

  parseExplains(explains) {
    if (!explains) return [];
    return explains.map(exp => {
      const match = exp.match(/^([a-z]+\.)\s*(.+)$/);
      if (match) {
        return { pos: match[1], meanings: [match[2]] };
      }
      return { pos: '', meanings: [exp] };
    });
  }

  getCapabilities() {
    return {
      supportedLanguages: ['zh-CN', 'zh-TW', 'en', 'ja', 'ko', 'fr', 'de', 'es'],
      supportDict: true,
      supportPhonetic: true,
      supportDetect: true,
      maxTextLength: 5000,
      qpsLimit: 10
    };
  }
}

// å…¶ä»–é€‚é…å™¨ç±»ä¼¼å®ç°...
```

#### ç¿»è¯‘æœåŠ¡ç»Ÿä¸€å…¥å£

```javascript
// translation-service.js

class TranslationService {
  constructor() {
    this.adapters = {
      baidu: BaiduAdapter,
      youdao: YoudaoAdapter,
      google: GoogleAdapter,
      deepl: DeepLAdapter
    };
  }

  /**
   * ç»Ÿä¸€ç¿»è¯‘å…¥å£
   * @param {TranslationRequest} request
   * @returns {Promise<TranslationResult>}
   */
  async translate(request) {
    const nodes = await this.getEnabledNodes();

    // æŒ‰ä¼˜å…ˆçº§ä¾æ¬¡å°è¯•
    for (const node of nodes) {
      const adapter = this.createAdapter(node);
      const result = await adapter.translate(request);

      if (result.success) {
        return result;
      }

      // è®°å½•å¤±è´¥ï¼Œç»§ç»­å°è¯•ä¸‹ä¸€ä¸ª
      console.warn(`[Translation] ${node.name} failed:`, result.error);
    }

    // æ‰€æœ‰èŠ‚ç‚¹å¤±è´¥ï¼Œå°è¯•é™çº§
    if (await this.isFallbackEnabled()) {
      return this.fallbackTranslate(request);
    }

    return {
      success: false,
      provider: 'none',
      translation: '',
      error: { code: 'ALL_FAILED', message: 'æ‰€æœ‰ç¿»è¯‘æœåŠ¡å‡ä¸å¯ç”¨' }
    };
  }

  /**
   * è¯å…¸æŸ¥è¯¢ï¼ˆä¼˜å…ˆä½¿ç”¨æ”¯æŒè¯å…¸çš„æœåŠ¡ï¼‰
   */
  async lookup(word) {
    const nodes = await this.getEnabledNodes();

    // ä¼˜å…ˆé€‰æ‹©æ”¯æŒè¯å…¸çš„èŠ‚ç‚¹
    const dictNodes = nodes.filter(n =>
      this.adapters[n.provider]?.prototype?.getCapabilities?.()?.supportDict
    );

    const targetNodes = dictNodes.length > 0 ? dictNodes : nodes;

    return this.translate({
      text: word,
      from: 'auto',
      to: 'zh-CN',
      type: 'word',
      options: { needDict: true, needPhonetic: true }
    });
  }

  createAdapter(node) {
    const AdapterClass = this.adapters[node.provider];
    if (!AdapterClass) {
      throw new Error(`Unknown provider: ${node.provider}`);
    }
    return new AdapterClass(node);
  }
}

// å¯¼å‡ºå•ä¾‹
const translationService = new TranslationService();
```

### æŠ€æœ¯å®ç°

#### 1. æ–°å¢æ–‡ä»¶

| æ–‡ä»¶ | èŒè´£ |
|------|------|
| `js/content/translation-service.js` | ç¿»è¯‘æœåŠ¡ç»Ÿä¸€å…¥å£ |
| `js/content/translation-adapters.js` | å„æä¾›å•†é€‚é…å™¨å®ç° |
| `js/content/translation-types.js` | ç±»å‹å®šä¹‰å’Œå¸¸é‡ |
| `js/options-translation.js` | ç¿»è¯‘èŠ‚ç‚¹é…ç½® UI é€»è¾‘ |

#### 2. ä¿®æ”¹æ–‡ä»¶

| æ–‡ä»¶ | æ”¹åŠ¨ |
|------|------|
| `options.html` | æ·»åŠ ç¿»è¯‘ API é…ç½® UI |
| `css/options.css` | ç¿»è¯‘èŠ‚ç‚¹æ ·å¼ï¼ˆå¤ç”¨ AI èŠ‚ç‚¹æ ·å¼ï¼‰ |
| `js/content/api-client.js` | è°ƒç”¨ `translationService.translate()` |
| `js/content/storage.js` | æ·»åŠ ç¿»è¯‘èŠ‚ç‚¹å­˜å‚¨é€»è¾‘ |
| `manifest.json` | æ·»åŠ æ–° JS æ–‡ä»¶å¼•ç”¨ |

## Impact

### ç”¨æˆ·ä½“éªŒ
- å¯ä½¿ç”¨è‡ªå·±çš„ API å¯†é’¥ï¼Œé¿å…å…±äº«é™åˆ¶
- å¤šèŠ‚ç‚¹å¤‡é€‰ï¼Œæé«˜ç¿»è¯‘å¯ç”¨æ€§
- å¯é€‰æ‹©ç¿»è¯‘è´¨é‡æ›´é«˜çš„æœåŠ¡

### ä»£ç æ”¹åŠ¨
- ä¸­ç­‰è§„æ¨¡ï¼Œä¸»è¦æ˜¯æ–°å¢é…ç½® UI å’Œ API å°è£…
- å¤ç”¨ç°æœ‰ AI èŠ‚ç‚¹é…ç½®çš„ UI æ¨¡å¼å’Œæ ·å¼
- å¯¹ç°æœ‰ç¿»è¯‘é€»è¾‘çš„æ”¹åŠ¨è¾ƒå°ï¼ˆä»…ä¿®æ”¹è°ƒç”¨å…¥å£ï¼‰

### å…¼å®¹æ€§
- å®Œå…¨å‘åå…¼å®¹ï¼Œæœªé…ç½®æ—¶ä½¿ç”¨ç°æœ‰é€»è¾‘
- ç°æœ‰ç”¨æˆ·æ— éœ€ä»»ä½•æ“ä½œå³å¯ç»§ç»­ä½¿ç”¨

## Risks & Mitigations

| é£é™© | ç¼“è§£æªæ–½ |
|------|----------|
| API å¯†é’¥æ³„éœ² | åŠ å¯†å­˜å‚¨ï¼ŒUI éšè—æ˜¾ç¤º |
| å„æœåŠ¡ API å˜æ›´ | æ¨¡å—åŒ–å°è£…ï¼Œæ˜“äºæ›´æ–° |
| ç”¨æˆ·é…ç½®é”™è¯¯ | è¿é€šæ€§æµ‹è¯• + è¯¦ç»†é”™è¯¯æç¤º |
| å…è´¹é¢åº¦ç”¨å°½ | æ˜¾ç¤ºå‰©ä½™é¢åº¦ï¼ˆå¦‚ API æ”¯æŒï¼‰ |
| è·¨åŸŸè¯·æ±‚é™åˆ¶ | é€šè¿‡ background script ä»£ç†è¯·æ±‚ |

## Dependencies

- ç°æœ‰ AI èŠ‚ç‚¹é…ç½® UI ç»„ä»¶ï¼ˆå¤ç”¨ï¼‰
- MD5 ç­¾ååº“ï¼ˆç™¾åº¦/æœ‰é“ API éœ€è¦ï¼‰
- å„ç¿»è¯‘æœåŠ¡çš„ API æ–‡æ¡£

## Related Specs

- `enhance-selection-popup` - ä½¿ç”¨ç¿»è¯‘åŠŸèƒ½çš„ä¸Šå±‚åŠŸèƒ½
- `translation-config` - ç°æœ‰ç¿»è¯‘é…ç½®ï¼ˆå°†è¢«æ‰©å±•ï¼‰

## Status

- [x] Proposal drafted
- [ ] Design reviewed
- [ ] Tasks defined
- [ ] Approved for implementation
